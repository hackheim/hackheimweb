---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/landing/Header.astro";
import Footer from "../../components/landing/Footer.astro";
import Icon from "../../components/ui/Icon.astro";
import Button from "../../components/ui/Button.astro";
import ZoomImage from "@components/ui/ZoomImage.astro";

export async function getStaticPaths() {
    const newsEntries = await getCollection("news");
    const sortedEntries = newsEntries.sort(
        (a, b) =>
            new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
    );

    return sortedEntries.map((entry, index) => ({
        params: { slug: entry.id },
        props: {
            entry,
            prevEntry: sortedEntries[index + 1] || null,
            nextEntry: sortedEntries[index - 1] || null,
        },
    }));
}

const { entry, prevEntry, nextEntry } = Astro.props;
const { Content } = await render(entry);

function formatDate(date: Date) {
    return new Date(date).toLocaleDateString("nb-NO", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
}
---

<Layout>
    <div class="min-h-screen">
        <Header />
        <main class="py-16 px-4">
            <div class="max-w-4xl mx-auto">
                <div class="mb-8">
                    <Button variant="ghost" href="/news" class="mb-6">
                        <Icon name="ArrowLeft" class="w-4 h-4 mr-2" />
                        Tilbake til nyheter
                    </Button>

                    <article
                        class="bg-background/60 backdrop-blur-sm border border-border/50 rounded-xl p-10"
                    >
                        <header class="mb-8">
                            <h1 class="text-4xl font-bold text-foreground mb-4">
                                {entry.data.title}
                            </h1>

                            {
                                entry.data.image && (
                                    <ZoomImage
                                        src={entry.data.image}
                                        alt={entry.data.title}
                                        width={900}
                                        class="rounded-lg mb-6"
                                    />
                                )
                            }

                            <div
                                class="flex items-center text-muted-foreground"
                            >
                                <Icon name="Calendar" class="w-4 h-4 mr-2" />
                                <time datetime={entry.data.date.toISOString()}>
                                    {formatDate(entry.data.date)}
                                </time>
                                {
                                    entry.data.author && (
                                        <>
                                            <span class="mx-3">â€¢</span>
                                            <Icon
                                                name="User"
                                                class="w-4 h-4 mr-1"
                                            />
                                            {entry.data.author}
                                        </>
                                    )
                                }
                            </div>
                        </header>

                        <div
                            class="prose prose-lg max-w-none prose-headings:text-foreground prose-p:text-foreground prose-strong:text-foreground prose-a:text-primary hover:prose-a:text-primary/80"
                        >
                            <Content />
                        </div>
                    </article>

                    <nav class="mt-8 flex justify-between items-center">
                        {
                            prevEntry ? (
                                <Button
                                    variant="ghost"
                                    href={`/news/${prevEntry.id}`}
                                    class="flex items-center"
                                >
                                    <Icon
                                        name="ArrowLeft"
                                        class="w-4 h-4 mr-2"
                                    />
                                    <div class="text-left">
                                        <div class="text-xs text-muted-foreground">
                                            Forrige
                                        </div>
                                        <div class="font-medium">
                                            {prevEntry.data.title}
                                        </div>
                                    </div>
                                </Button>
                            ) : (
                                <div />
                            )
                        }

                        {
                            nextEntry ? (
                                <Button
                                    variant="ghost"
                                    href={`/news/${nextEntry.id}`}
                                    class="flex items-center text-right"
                                >
                                    <div class="text-right">
                                        <div class="text-xs text-muted-foreground">
                                            Neste
                                        </div>
                                        <div class="font-medium">
                                            {nextEntry.data.title}
                                        </div>
                                    </div>
                                    <Icon
                                        name="ArrowRight"
                                        class="w-4 h-4 ml-2"
                                    />
                                </Button>
                            ) : (
                                <div />
                            )
                        }
                    </nav>
                </div>
            </div>
        </main>
        <Footer />
    </div>
</Layout>
