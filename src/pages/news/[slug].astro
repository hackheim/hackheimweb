---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/landing/Header.astro";
import Footer from "../../components/landing/Footer.astro";
import Icon from "../../components/ui/Icon.astro";
import Button from "../../components/ui/Button.astro";

export async function getStaticPaths() {
    const newsEntries = await getCollection("news");
    return newsEntries.map((entry) => ({
        params: { slug: entry.id },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

function formatDate(date: Date) {
    return new Date(date).toLocaleDateString("nb-NO", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
}
---

<Layout>
    <div class="min-h-screen">
        <Header />
        <main class="py-16 px-4">
            <div class="max-w-4xl mx-auto">
                <div class="mb-8">
                    <Button variant="ghost" href="/news" class="mb-6">
                        <Icon name="ArrowLeft" class="w-4 h-4 mr-2" />
                        Tilbake til nyheter
                    </Button>

                    <article
                        class="bg-card border border-border rounded-lg p-8"
                    >
                        <header class="mb-8">
                            {
                                entry.data.image && (
                                    <img
                                        src={entry.data.image}
                                        alt={entry.data.title}
                                        class="w-full h-64 object-cover rounded-lg mb-6"
                                    />
                                )
                            }

                            <h1 class="text-4xl font-bold text-foreground mb-4">
                                {entry.data.title}
                            </h1>

                            <div
                                class="flex items-center text-muted-foreground"
                            >
                                <Icon name="Calendar" class="w-4 h-4 mr-2" />
                                <time datetime={entry.data.date.toISOString()}>
                                    {formatDate(entry.data.date)}
                                </time>
                                {
                                    entry.data.author && (
                                        <>
                                            <span class="mx-3">â€¢</span>
                                            <Icon
                                                name="User"
                                                class="w-4 h-4 mr-1"
                                            />
                                            {entry.data.author}
                                        </>
                                    )
                                }
                            </div>
                        </header>

                        <div
                            class="prose prose-lg max-w-none prose-headings:text-foreground prose-p:text-foreground prose-strong:text-foreground prose-a:text-primary hover:prose-a:text-primary/80"
                        >
                            <Content />
                        </div>
                    </article>
                </div>
            </div>
        </main>
        <Footer />
    </div>
</Layout>
