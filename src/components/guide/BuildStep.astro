---
// src/components/guide/BuildStep.astro
const { id, title, tags = [], includeTags = null, excludeTags = null } = Astro.props;

const includePass = includeTags ? tags.some(t => includeTags.includes(t)) : true;
const excludePass = excludeTags ? !tags.some(t => excludeTags.includes(t)) : true;
if (!(includePass && excludePass)) return;

// Increment and get step number from shared counter
if (!Astro.locals.stepCounter) {
  Astro.locals.stepCounter = { current: 0 };
}
Astro.locals.stepCounter.current += 1;
const stepNumber = Astro.locals.stepCounter.current;
---
<section id={id} class="build-step rounded-2xl border border-blue-200 bg-white shadow-sm p-6 my-8 relative print:break-inside-avoid print:page-break-inside-avoid">
  <header class="mb-4">
    <h3 class="m-0 text-xl font-semibold text-gray-900 flex items-center gap-3">
      <span class="step-number flex-shrink-0 w-9 h-9 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold text-lg">
        {stepNumber}
      </span>
      ðŸ”§ {title}
    </h3>
  </header>
  <div class="step-content prose prose-sm max-w-none"><slot /></div>
</section>